<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Music</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">

<style>
:root{
  --bg:#121212;--card:#181818;--hover:#222;--green:#1db954;
}
*{box-sizing:border-box}
body{
  margin:0;background:var(--bg);color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial;
}
header{
  padding:16px;font-size:22px;font-weight:800;
  background:linear-gradient(180deg,var(--green),var(--bg));
}
.search{padding:12px}
.search input{
  width:100%;padding:14px 16px;border-radius:999px;
  border:none;outline:none;font-size:16px;
}
.grid{
  display:grid;gap:12px;padding:12px;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
}
.card{
  background:var(--card);border-radius:14px;padding:10px;
  cursor:pointer;transition:.2s;
}
.card:hover{background:var(--hover)}
.card img{
  width:100%;border-radius:10px;
}
.title{margin-top:6px;font-weight:600;font-size:14px}
.artist{font-size:12px;color:#aaa}
.badge{
  font-size:10px;padding:2px 6px;border-radius:6px;
  background:#333;color:#ccc;margin-left:6px;
}
.actions{
  display:flex;gap:8px;margin-top:8px;
}
.btn{
  flex:1;text-align:center;font-size:12px;
  padding:6px;border-radius:8px;background:#222;
}
.btn.yt{background:#2a2a2a}

.player{
  position:fixed;bottom:0;left:0;right:0;
  background:#181818;padding:8px;border-top:1px solid #222;
}
.player audio{width:100%}

.notice{
  padding:8px 12px;font-size:12px;color:#aaa;
}
.yt-wrap{
  display:none;padding:10px;background:#000;
}
.yt-wrap iframe{
  width:100%;height:220px;border:0;border-radius:12px;
}
</style>
</head>

<body>

<header>ðŸŽ§ My Music</header>

<div class="search">
  <input id="q" placeholder="Search songs, artists, wordsâ€¦"
    onkeydown="if(event.key==='Enter')searchIA()">
</div>

<div id="note" class="notice"></div>
<div id="grid" class="grid"></div>

<div id="yt" class="yt-wrap">
  <iframe id="ytframe" allow="autoplay; encrypted-media"></iframe>
</div>

<div class="player">
  <audio id="audio" controls></audio>
</div>

<script>
const grid = document.getElementById('grid');
const audio = document.getElementById('audio');
const note = document.getElementById('note');
const yt = document.getElementById('yt');
const ytframe = document.getElementById('ytframe');

let searching = false;

async function searchIA(){
  if(searching) return;
  searching = true;

  const q = document.getElementById('q').value.trim();
  if(!q){ searching=false; return; }

  grid.innerHTML = '';
  yt.style.display='none';
  audio.pause(); audio.src='';
  note.textContent = 'Searching (low data mode)â€¦';

  const url =
`https://archive.org/advancedsearch.php?q=mediatype:audio AND (title:(${q}) OR creator:(${q}) OR description:(${q}))&fl[]=identifier,title,creator&rows=15&output=json`;

  try{
    const r = await fetch(url);
    const j = await r.json();

    if(j.response.docs.length){
      note.textContent = 'Results from Internet Archive';
      j.response.docs.forEach(d => addCard(d, q));
    }else{
      note.textContent = 'No IA result. YouTube option available.';
      addYTButton(q);
    }
  }catch{
    note.textContent = 'Network issue. YouTube option available.';
    addYTButton(q);
  }

  searching = false;
}

function addCard(d, q){
  const c = document.createElement('div');
  c.className='card';
  c.innerHTML=`
    <img loading="lazy" src="https://archive.org/services/img/${d.identifier}">
    <div class="title">${escape(d.title)} <span class="badge">IA</span></div>
    <div class="artist">${escape(d.creator||'Unknown')}</div>
    <div class="actions">
      <div class="btn" onclick="playIA('${d.identifier}')">Play</div>
      <div class="btn yt" onclick="openYT('${q}')">YT</div>
    </div>`;
  grid.appendChild(c);
}

async function playIA(id){
  yt.style.display='none';
  const r = await fetch(`https://archive.org/metadata/${id}`);
  const j = await r.json();
  const f = j.files.find(x =>
    x.name.endsWith('.mp3') || x.name.endsWith('.ogg') || x.name.endsWith('.m4a')
  );
  if(!f){ alert('No playable audio'); return; }
  audio.src = `https://archive.org/download/${id}/${encodeURIComponent(f.name)}`;
  audio.play();
}

function addYTButton(q){
  grid.innerHTML=`
    <div class="card">
      <div class="title">Search on YouTube Music</div>
      <div class="artist">Manual play (low data)</div>
      <div class="actions">
        <div class="btn yt" onclick="openYT('${q}')">Open</div>
      </div>
    </div>`;
}

function openYT(q){
  yt.style.display='block';
  ytframe.src =
    `https://www.youtube.com/embed?listType=search&list=${encodeURIComponent(q)}`;
}

function escape(s){
  return String(s).replace(/[&<>"']/g,m=>(
    {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]
  ));
}
</script>

</body>
</html>
